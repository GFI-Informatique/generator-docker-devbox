version: "2"
networks:
  nginx-proxy:
    external:
      name: nginx-proxy
services:
{{#if webContainer}}
  web:
  {{#if_eq webImage 'php'}}
    environment:
      - XDEBUG_CONFIG=idekey=remote-debug remote_host=${HOST_IP}
      - VIRTUAL_HOST={{projectName}}.app
    networks:
      - default
      - nginx-proxy
    ports :
      - "{{portPrefix}}80:80"
  {{/if_eq ~}}
{{/if ~}}
{{#if dbContainer}}
  db:
  {{#if_eq dbImage 'postgres'}}
    ports:
      - "{{portPrefix}}32:5432"
  {{/if_eq ~}}
  {{#if_eq dbImage 'mysql'}}
    ports:
      - "{{portPrefix}}06:3306"
  {{/if_eq ~}}
{{/if ~}}
{{#if mapserverContainer}}
  mapserver:
    restart: unless-stopped
    environment:
      - VIRTUAL_HOST=mapserver.{{projectName}}.app
    networks:
      - default
      - nginx-proxy
    ports:
      - "{{portPrefix}}85:80"
{{/if ~}}
{{#if mailcatcherContainer}}
  mailcatcher:
    build:
      context: .docker/mailcatcher
      args:
       http_proxy: ${http_proxy}
       https_proxy: ${https_proxy}
       no_proxy: ${no_proxy}
    environment:
      - http_proxy=${http_proxy}
      - https_proxy=${https_proxy}
      - no_proxy=${no_proxy}
      - VIRTUAL_HOST=mailcatcher.{{projectName}}.app
    networks:
      - default
      - nginx-proxy
{{/if ~}}
{{#if mavenContainer}}
  maven:
    build:
      context: .docker/maven
      args:
       http_proxy: ${http_proxy}
       https_proxy: ${https_proxy}
       no_proxy: ${no_proxy}
    environment:
      http_proxy: ${http_proxy}
      https_proxy: ${https_proxy}
      no_proxy: ${no_proxy}
    volumes:
      - ".:/usr/src/app"
      - "maven:/var/www/.m2"
{{/if ~}}
{{#if mavenContainer}}
volumes:
  maven: ~
{{/if ~}}
