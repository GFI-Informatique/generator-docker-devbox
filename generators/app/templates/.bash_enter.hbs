########################################################################
# This is a smartcd script.  Commands you type will be run when you
# enter this directory.  The string __PATH__ will be replaced with
# the current path.  Some examples are editing your $PATH or creating
# a temporary alias:
#
#     autostash PATH=__PATH__/bin:$PATH
#     autostash alias restart="service stop; sleep 1; service start"
#
# See http://smartcd.org for more ideas about what can be put here
#######################################################################
if [ -z "$BASH_ENTER_ALIAS_ONLY" ]; then
  autostash COMPOSE_PROJECT_DIR=$PWD

  # Define DOCKER_DEVBOX_ENV to customize environment configuration files
  autostash DOCKER_DEVBOX_ENV="${DOCKER_DEVBOX_ENV:-dev}"

  if [ -f "docker-compose.override.$DOCKER_DEVBOX_ENV.yml" ]; then
    ln -fs "docker-compose.override.$DOCKER_DEVBOX_ENV.yml" "docker-compose.override.yml"
  fi
  {{#if mapserverContainer}}
  if [ -f "mapserver/mapserver.$DOCKER_DEVBOX_ENV.map" ]; then
    ln -fs "mapserver/mapserver.$DOCKER_DEVBOX_ENV.yml" "mapserver/mapserver.map"
  fi
  {{/if}}
  {{#if drupalInit}}
  if [ -f "web/sites/default/settings.$DOCKER_DEVBOX_ENV.php" ]; then
    ln -fs "web/sites/default/settings.$DOCKER_DEVBOX_ENV.php" "web/sites/default/settings.php"
  fi
  {{/if}}
fi

autostash alias dc="docker-compose"
autostash alias run="docker-compose run --rm"

{{#if_eq webImage "php" ~}}
autostash alias php="docker-compose run --rm --user www-data --entrypoint php web"
autostash alias composer="docker-compose run --rm --user www-data --entrypoint composer web"
autostash alias drush="docker-compose run --rm --user www-data --entrypoint php --workdir=/var/www/html/web web ../vendor/drush/drush/drush"
autostash alias drupal="docker-compose run --rm --user www-data --entrypoint php --workdir=/var/www/html/web web ../vendor/drupal/console/bin/drupal"
{{/if_eq ~}}
{{#if_eq dbImage "postgres" ~}}
autostash alias psql="docker-compose exec --user www-data db psql -U {{projectName}}"
{{/if_eq ~}}
{{#if_eq dbImage "mysql" ~}}
autostash alias mysql="docker-compose exec --user root db mysql -U root"
{{/if_eq ~}}
{{#if phingContainer ~}}
autostash alias phing="docker-compose run --rm --user www-data --entrypoint php --workdir=/app/.phing builder /composer/vendor/phing/phing/bin/phing"
{{/if}}
{{#if nodeSassContainer ~}}
autostash alias node-sass="docker-compose run --rm node-sass"
autostash alias watch-sass="docker-compose run --rm --entrypoint chokidar node-sass \"./**/*.scss\" --initial --verbose -p -c \"node-sass scss -r -o css --importer /usr/local/lib/node_modules/compass-importer/index.js --sourceComments true\""
{{/if}}

{{#if init ~}}
if [ -f "./init/init.sh" ] && [ ! -f ./init/.initialized ] && [ -z "$BASH_ENTER_ALIAS_ONLY" ]; then
  read -p "Project is not initialized. Do you want to initialize it ? [y/N]: " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]
  then
      echo "Running initialization script: ./init/init.sh"
      ./init/init.sh
  else
      echo "Initialization skipped"
  fi
fi
{{/if}}
